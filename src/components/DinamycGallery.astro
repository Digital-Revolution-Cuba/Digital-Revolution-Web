---
/**
 * DinamycGallery Component
 *
 * Main gallery with category switching and slider navigation.
 * Renders items dynamically from local data arrays — no API calls.
 *
 * Each category's items are rendered through the appropriate card
 * component determined by the item's `type` discriminant.
 */

// Import data
import { arteGallery, fotografiaGallery, musicaGallery } from '../data';
import type { CategoryConfig } from '../data/types';

// Import UI components
import CategoryButton from './gallery/CategoryButton.astro';
import FotografiaCard from './gallery/FotografiaCard.astro';
import GalleryItemCard from './gallery/GalleryItem.astro';
import MusicCard from './gallery/MusicCard.astro';
import NavigationButton from './gallery/NavigationButton.astro';

// Gallery categories — single source of truth
const categories: readonly CategoryConfig[] = [
  { id: 'arte', label: 'Arte', items: arteGallery },
  { id: 'musica', label: 'Música', items: musicaGallery },
  { id: 'fotografia', label: 'Fotografía', items: fotografiaGallery },
] as const;
---

<section id="galeria" class="gallery-section">
  <!-- Ensure shared animation variables are loaded so JS can read them -->
  <link rel="stylesheet" href="/src/styles/animations.css" />

  <!-- Category buttons -->
  <div class="category-controls" data-category-buttons>
    {
      categories.map((category, index) => (
        <CategoryButton
          category={category.id}
          label={category.label}
          isActive={index === 0}
        />
      ))
    }
  </div>

  <!-- Gallery container with responsive wrapper -->
  <div class="gallery-outer-wrapper">
    <div class="gallery-inner-container">
      <!-- Previous button -->
      <NavigationButton
        id="prevBtn"
        direction="prev"
        ariaLabel="Previous gallery page"
      />

      <!-- Gallery slider -->
      <div class="gallery-container">
        <div class="gallery-viewport">
          <div id="imageSlider" class="gallery-track">
            {
              categories.flatMap((category) =>
                category.items.map((item) => {
                  switch (item.type) {
                    case 'arte':
                      return <GalleryItemCard item={item} />;
                    case 'musica':
                      return <MusicCard item={item} />;
                    case 'fotografia':
                      return <FotografiaCard item={item} />;
                  }
                }),
              )
            }
          </div>
        </div>
      </div>

      <!-- Next button -->
      <NavigationButton
        id="nextBtn"
        direction="next"
        ariaLabel="Next gallery page"
      />
    </div>

    <!-- Behaviour is initialized from a centralized client initializer -->
    <!-- Add to the page that uses this component: -->
    <!-- <script type="module" src="/src/client/initializers/galeria.ts"></script> -->

    <style>
      /* Base gallery section */
      .gallery-section {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 80dvh;
        width: 100%;
        background: #030712;
        overflow: hidden;
        padding: 4rem 1rem;
      }

      /* Category controls */
      .category-controls {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 20;
        display: flex;
        gap: 1rem;
        padding: 1.5rem;
        flex-wrap: wrap;
      }

      /* Outer wrapper - controls overall layout */
      .gallery-outer-wrapper {
        width: 100%;
        max-width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 3rem;
      }

      /* Inner container - holds buttons and gallery */
      .gallery-inner-container {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
        max-width: calc(100vw - 2rem);
      }

      /* Gallery container - the visible area */
      .gallery-container {
        position: relative;
        overflow: hidden;
        width: 100%;
        flex: 1;
        max-width: 100%;
      }

      /* Gallery viewport */
      .gallery-viewport {
        width: 100%;
        overflow: visible;
        position: relative;
        /* add bottom padding so card bottoms and shadows are visible and not clipped */
        padding-bottom: 1.25rem;
      }

      /* Gallery track - the moving strip */
      .gallery-track {
        display: flex;
        align-items: flex-start; /* align cards to top so bottom corners are inside container */
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
        gap: 1rem;
      }

      /* Hide scrollbars */
      .gallery-viewport {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }

      .gallery-viewport::-webkit-scrollbar {
        display: none;
      }

      .gallery-container::before,
      .gallery-container::after {
        display: none !important;
      }

      /* RESPONSIVE BREAKPOINTS */

      /* Mobile: 1 card visible (320px - 640px) */
      @media (max-width: 640px) {
        .gallery-section {
          min-height: 70dvh;
          padding: 2rem 0.5rem;
        }

        .category-controls {
          padding: 1rem;
          gap: 0.5rem;
        }

        .gallery-inner-container {
          max-width: calc(100vw - 1rem);
          gap: 0.25rem;
        }

        .gallery-container {
          max-width: calc(100vw - 120px);
        }
      }

      /* Small tablets: 2 cards visible (641px - 768px) */
      @media (min-width: 641px) and (max-width: 768px) {
        .gallery-section {
          padding: 3rem 1rem;
        }

        .gallery-inner-container {
          max-width: calc(100vw - 2rem);
        }

        .gallery-container {
          max-width: calc(100vw - 120px);
        }
      }

      /* Tablets: 3 cards visible (769px - 1023px) */
      @media (min-width: 769px) and (max-width: 1023px) {
        .gallery-inner-container {
          max-width: min(960px, calc(100vw - 2rem));
        }

        .gallery-container {
          max-width: calc(100vw - 120px);
        }
      }

      /* Desktop: 4 cards visible (1024px+) */
      @media (min-width: 1024px) {
        .gallery-inner-container {
          max-width: 1280px;
        }

        .gallery-container {
          width: calc(4 * 285px + 3 * 1rem + 4px);
          max-width: calc(4 * 285px + 3 * 1rem + 4px);
        }
      }

      /* Reduced motion */
      @media (prefers-reduced-motion: reduce) {
        .gallery-track {
          transition: none;
        }
      }
    </style>
  </div>
</section>
